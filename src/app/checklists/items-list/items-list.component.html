<div class="container">
  @if (_checklist) {
    <div
        cdkDropList
        class="list"
        [cdkDropListData]="_checklist.items"
        (cdkDropListDropped)="onDrop($event)">
      @for (item of _checklist.items; track item) {
        <div
            class="list-item"
            cdkDrag
            cdkDragLockAxis="y">
          <mat-icon
              cdkDragHandle
              class="mat-icon-rtl-mirror item-icon drag-icon"
              fontIcon="drag_handle" />
          <button
              mat-icon-button
              mat-medium-icon-button
              class="item-icon"
              (click)="editing = true"
              [attr.aria-label]="'Edit ' + item.prompt">
            <mat-icon fontIcon="edit" />
          </button>
          <button
              mat-icon-button
              mat-medium-icon-button
              class="item-icon"
              [attr.aria-label]="'Indent ' + item.prompt + ' left'"
              [disabled]="item.indent == 0"
              (click)="onIndent(item, -1)">
            <mat-icon fontIcon="format_indent_decrease" />
          </button>
          <button
              mat-icon-button
              mat-medium-icon-button
              class="item-icon"
              [attr.aria-label]="'Indent ' + item.prompt + ' right'"
              [disabled]="item.indent == 4"
              (click)="onIndent(item, 1)">
            <mat-icon fontIcon="format_indent_increase" />
          </button>
          <span
              class="item"
              [class.item-prompt]="item.type == ChecklistItem_Type.ITEM_PROMPT"
              [class.item-title]="item.type == ChecklistItem_Type.ITEM_TITLE"
              [class.item-warning]="item.type == ChecklistItem_Type.ITEM_WARNING"
              [class.item-caution]="item.type == ChecklistItem_Type.ITEM_CAUTION"
              [class.item-note]="item.type == ChecklistItem_Type.ITEM_NOTE"
              [class.item-space]="item.type == ChecklistItem_Type.ITEM_SPACE"
              [style.padding-left]="item.indent*25 + 'px'">
            @if (!editing) {
              {{item.prompt}}
            } @else {
              <mat-form-field
                  appearance="outline"
                  class="prompt-input">
                <mat-label>Prompt text</mat-label>
                <input
                    #promptInput
                    matInput
                    required
                    [value]="item.prompt">
                <button
                    mat-icon-button
                    mat-medium-icon-button
                    matSuffix
                    class="item-icon"
                    [attr.aria-label]="'Save changes to ' + item.prompt"
                    (click)="item.prompt = promptInput.value; onItemUpdated(); editing = false">
                  <mat-icon fontIcon="save" />
                </button>
                <button
                    mat-icon-button
                    mat-medium-icon-button
                    matSuffix
                    class="item-icon"
                    [attr.aria-label]="'Cancel changes to ' + item.prompt"
                    (click)="editing = false">
                  <mat-icon fontIcon="cancel" />
                </button>
              </mat-form-field>
            }
          </span>
          @if (item.type === ChecklistItem_Type.ITEM_PROMPT) {
            <!-- TODO: Make the dots fill the center space and nothing more -->
            <span class="prompt-spacer" *ngIf="!editing">........................</span>
            <span class="prompt-expectation">
              {{item.expectation}}
            </span>
          }
          <div *cdkDragPlaceholder></div>
        </div>
      }
    </div>
  } @else {
    <div>
      Select or create a checklist from the left-side bar.
    </div>
  }
</div>